<?xml version="1.0" encoding="UTF-8"?>

<alvisnlp-plan id="main">


  <!--
  ///////////////////////////////////////////////////////////////////////////////////////
  //
  // I. Load html corpus
  //
  ///////////////////////////////////////////////////////////////////////////////////////
  -->

    <read-html href="modules/read-html.plan">
      <sourcePath>resources/Corpus-v-12-04-21/train/</sourcePath>
    </read-html>

  <!--
  ///////////////////////////////////////////////////////////////////////////////////////
  //
  // II. Segment text
  //
  ///////////////////////////////////////////////////////////////////////////////////////
  -->

    <!-- load segmentation plan -->
    <import>res://segmentation.plan</import>

    <!-- remove foreign words with label <FW> as they are usually not recognised by tree-tagger-->
    <remove-fw class="Action">
      <target>documents.sections.layer:words[@pos]</target>
      <action>set:remove-feature:pos</action>
      <setFeatures/>
    </remove-fw>

    <!-- load treetagger -->
    <execute-treetagger href="modules/execute-treetagger.plan">
      <parFile>../../work/inrae/outils/tree-tagger/lib/french.par</parFile>
      <treeTaggerExecutable>../../work/inrae/outils/tree-tagger/bin/tree-tagger</treeTaggerExecutable>
    </execute-treetagger>



  <!--
  ///////////////////////////////////////////////////////////////////////////////////////
  //
  // III. Match fcu vocabulary
  //
  ///////////////////////////////////////////////////////////////////////////////////////
  -->

  <!-- remove ambiguous words that can be wrongfully associated with fcu concepts -->
  <remove-ambiguous-words class="Action">
    <target>documents.sections.layer:words[@lemma == "gel" or @lemma == "jachère" or @lemma == "orange" or @lemma == "marron" or @lemma == "fruit" or @lemma == "semence" or @lemma == "côte" or @lemma == "horticulture" or @lemma == "pépinière"]</target>
    <action>remove:words</action>
    <removeFromLayer/>
  </remove-ambiguous-words>

    <!-- load vocabulary and project it to a layer named fcu-->
    <project-fcu href="modules/project-lemma.plan">
      <source>resources/usageCulture20210112.rdf</source>
      <targetLayerName>fcu</targetLayerName>
    </project-fcu>


    <!--
    ///////////////////////////////////////////////////////////////////////////////////////
    //
    // IV. Match phenological stages
    //
    ///////////////////////////////////////////////////////////////////////////////////////
    -->


    <!-- load vocabulary and project it to a layer named stages -->
    <project-stage href="modules/project-lemma.plan">
      <source>resources/stades.rdf</source>
      <targetLayerName>stages</targetLayerName>
    </project-stage>

    <!-- delete repeating elements from the layer stages  -->
    <remove-equal class="Action">
      <target>documents.sections.layer:stages[outside:fcu]</target>
      <action>delete</action>
      <deleteElements/>
    </remove-equal>

    <!-- find patterns bbch -->
    <bbch-patterns href="modules/find-bbch-patterns.plan"/>


    <!--
    ///////////////////////////////////////////////////////////////////////////////////////
    //
    // VI. Find conjunctions
    //
    ///////////////////////////////////////////////////////////////////////////////////////
    -->

    <correct-conj class="Action">
        <target>documents.sections.layer:words[@form == "kaki"]</target>
        <action>set:feat:pos("NOM")</action>
        <setFeatures/>
    </correct-conj>

    <conj-patterns href="modules/find-conj-patterns.plan"/>


    <!--
    ///////////////////////////////////////////////////////////////////////////////////////
    //
    // VII. Save results
    //
    ///////////////////////////////////////////////////////////////////////////////////////
    -->
    <export href="modules/export.plan"/>


</alvisnlp-plan>
